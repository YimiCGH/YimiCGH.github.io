---
layout: post
title: '在 Unity 中开发HTN Planner (3)'
excerpt: "框架设计与实现"
categories:
      - Dev Log
tags:
  - Log
  - Unity
  - AI
last_modified_at: 2019-11-18T16:30:00-23:00
---
{% include toc %}
---

## 初始数据

在把编辑器做完之后，准备测试框架稳定性。需要准备的数据有
- 初始状态
  - 设置当前的世界状态，以便接下来的规划器在该状态下进行分析规划
- 目标任务
  - 给出一个任务，规划器将根据当前世界状态对该任务进行分解，得到一个可执行的解决方案


## 规划器（Planner）

这里比较重要的是规划器（Planner）,它负责算法的实现，分析世界状态，使用合适的方法分解任务，最终生成一个解决方案，即一个行动列表。另外，为了进行规划分析，它需要得到一份世界状态的副本，以便用来模拟每个行动的后果。

## 计划执行器（Plan Runner）
从规划器得到解决方案后，会尝试按顺序执行每个行动，并把行动效果应用到世界状态上。如果任务执行失败，计划也会失败，并且强制规划器重新规划。因为在实际执行过程中，世界状态不在是静态的，收诸多因素的影响，可能会发生变化，导致计划中的某项行动的前提条件不在满足，从而任务失败。

## 下一步

准备扩展功能
- AI对世界的感知，如视觉，听觉
  - 为此，给AI提供感知器用来感知世界中某些信息
- AI短期记忆
  - 有种傻傻的AI，如一旦敌人离开视野，会马上回到巡逻，然后一看到敌人，又开始追击，因此，需要一种惯性来避免状态的来回切换。即，短期内，不会在回到该状态
- 多代理
  - 让尽可能多的代理智能体同时进行规划
  - 对于RPG这种，一个场景内能够支持100个智能体已经足够
  - 而对于RTS这种，动则上千单位，应该尽可能的分层设计
    - 如，由上层战略层进行宏观调控，个体Ai只进行一些简单Ai和上层指示的接受
- 调试器
  - 提供计划查看
  - 计划模拟
  - 运算消耗
